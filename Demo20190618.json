{"paragraphs":[{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560823774837_-1620584433","id":"20190618-020934_514886973","dateCreated":"2019-06-18T02:09:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:376","text":"%sh\nwget https://raw.githubusercontent.com/ywchiu/micronbigdata/master/Spark/churnTrain.csv\nmv churnTrain.csv /tmp/","dateUpdated":"2019-06-18T02:09:53+0000","dateFinished":"2019-06-18T02:09:57+0000","dateStarted":"2019-06-18T02:09:53+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2019-06-18 02:09:56--  https://raw.githubusercontent.com/ywchiu/micronbigdata/master/Spark/churnTrain.csv\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.0.133, 151.101.64.133, 151.101.128.133, ...\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.0.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 356734 (348K) [text/plain]\nSaving to: ‘churnTrain.csv’\n\n     0K .......... .......... .......... .......... .......... 14% 4.77M 0s\n    50K .......... .......... .......... .......... .......... 28% 6.92M 0s\n   100K .......... .......... .......... .......... .......... 43% 43.8M 0s\n   150K .......... .......... .......... .......... .......... 57% 60.4M 0s\n   200K .......... .......... .......... .......... .......... 71% 8.51M 0s\n   250K .......... .......... .......... .......... .......... 86% 59.3M 0s\n   300K .......... .......... .......... .......... ........  100% 65.7M=0.03s\n\n2019-06-18 02:09:56 (12.8 MB/s) - ‘churnTrain.csv’ saved [356734/356734]\n\n"}]}},{"text":"%sh\nhead /tmp/churnTrain.csv","user":"anonymous","dateUpdated":"2019-06-18T02:10:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560823793413_-1535692844","id":"20190618-020953_237374105","dateCreated":"2019-06-18T02:09:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:532","dateFinished":"2019-06-18T02:10:14+0000","dateStarted":"2019-06-18T02:10:14+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\"\",\"state\",\"account_length\",\"area_code\",\"international_plan\",\"voice_mail_plan\",\"number_vmail_messages\",\"total_day_minutes\",\"total_day_calls\",\"total_day_charge\",\"total_eve_minutes\",\"total_eve_calls\",\"total_eve_charge\",\"total_night_minutes\",\"total_night_calls\",\"total_night_charge\",\"total_intl_minutes\",\"total_intl_calls\",\"total_intl_charge\",\"number_customer_service_calls\",\"churn\"\n\"1\",\"KS\",128,\"area_code_415\",\"no\",\"yes\",25,265.1,110,45.07,197.4,99,16.78,244.7,91,11.01,10,3,2.7,1,\"no\"\n\"2\",\"OH\",107,\"area_code_415\",\"no\",\"yes\",26,161.6,123,27.47,195.5,103,16.62,254.4,103,11.45,13.7,3,3.7,1,\"no\"\n\"3\",\"NJ\",137,\"area_code_415\",\"no\",\"no\",0,243.4,114,41.38,121.2,110,10.3,162.6,104,7.32,12.2,5,3.29,0,\"no\"\n\"4\",\"OH\",84,\"area_code_408\",\"yes\",\"no\",0,299.4,71,50.9,61.9,88,5.26,196.9,89,8.86,6.6,7,1.78,2,\"no\"\n\"5\",\"OK\",75,\"area_code_415\",\"yes\",\"no\",0,166.7,113,28.34,148.3,122,12.61,186.9,121,8.41,10.1,3,2.73,3,\"no\"\n\"6\",\"AL\",118,\"area_code_510\",\"yes\",\"no\",0,223.4,98,37.98,220.6,101,18.75,203.9,118,9.18,6.3,6,1.7,0,\"no\"\n\"7\",\"MA\",121,\"area_code_510\",\"no\",\"yes\",24,218.2,88,37.09,348.5,108,29.62,212.6,118,9.57,7.5,7,2.03,3,\"no\"\n\"8\",\"MO\",147,\"area_code_415\",\"yes\",\"no\",0,157,79,26.69,103.1,94,8.76,211.8,96,9.53,7.1,6,1.92,0,\"no\"\n\"9\",\"LA\",117,\"area_code_408\",\"no\",\"no\",0,184.5,97,31.37,351.6,80,29.89,215.8,90,9.71,8.7,4,2.35,1,\"no\"\n"}]}},{"text":"%pyspark\nraw_data = sc.textFile(\"file:///tmp/churnTrain.csv\")\nheader = raw_data.first()\nheader","user":"anonymous","dateUpdated":"2019-06-18T02:11:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560823807157_2112896300","id":"20190618-021007_1063966870","dateCreated":"2019-06-18T02:10:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:614","dateFinished":"2019-06-18T02:11:50+0000","dateStarted":"2019-06-18T02:11:49+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"'\"\",\"state\",\"account_length\",\"area_code\",\"international_plan\",\"voice_mail_plan\",\"number_vmail_messages\",\"total_day_minutes\",\"total_day_calls\",\"total_day_charge\",\"total_eve_minutes\",\"total_eve_calls\",\"total_eve_charge\",\"total_night_minutes\",\"total_night_calls\",\"total_night_charge\",\"total_intl_minutes\",\"total_intl_calls\",\"total_intl_charge\",\"number_customer_service_calls\",\"churn\"'\n"}]}},{"text":"%pyspark\nskip_data = raw_data.filter(lambda line: line != header)\nskip_data.take(3)","user":"anonymous","dateUpdated":"2019-06-18T02:12:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560823909283_1694258848","id":"20190618-021149_770913406","dateCreated":"2019-06-18T02:11:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:735","dateFinished":"2019-06-18T02:12:26+0000","dateStarted":"2019-06-18T02:12:25+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['\"1\",\"KS\",128,\"area_code_415\",\"no\",\"yes\",25,265.1,110,45.07,197.4,99,16.78,244.7,91,11.01,10,3,2.7,1,\"no\"', '\"2\",\"OH\",107,\"area_code_415\",\"no\",\"yes\",26,161.6,123,27.47,195.5,103,16.62,254.4,103,11.45,13.7,3,3.7,1,\"no\"', '\"3\",\"NJ\",137,\"area_code_415\",\"no\",\"no\",0,243.4,114,41.38,121.2,110,10.3,162.6,104,7.32,12.2,5,3.29,0,\"no\"']\n"}]}},{"text":"%pyspark\nsplitlines = skip_data.map(lambda l: l.split(\",\"))\nsplitlines.take(3)","user":"anonymous","dateUpdated":"2019-06-18T02:12:56+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560823945719_-1680142248","id":"20190618-021225_1470155187","dateCreated":"2019-06-18T02:12:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:816","dateFinished":"2019-06-18T02:12:56+0000","dateStarted":"2019-06-18T02:12:56+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[['\"1\"', '\"KS\"', '128', '\"area_code_415\"', '\"no\"', '\"yes\"', '25', '265.1', '110', '45.07', '197.4', '99', '16.78', '244.7', '91', '11.01', '10', '3', '2.7', '1', '\"no\"'], ['\"2\"', '\"OH\"', '107', '\"area_code_415\"', '\"no\"', '\"yes\"', '26', '161.6', '123', '27.47', '195.5', '103', '16.62', '254.4', '103', '11.45', '13.7', '3', '3.7', '1', '\"no\"'], ['\"3\"', '\"NJ\"', '137', '\"area_code_415\"', '\"no\"', '\"no\"', '0', '243.4', '114', '41.38', '121.2', '110', '10.3', '162.6', '104', '7.32', '12.2', '5', '3.29', '0', '\"no\"']]\n"}]}},{"text":"%pyspark\nfrom pyspark.mllib.linalg import Vectors\nfrom pyspark.mllib.regression import LabeledPoint \ndef parseLine(col):\n    features = []\n    churn = col[-1]\n    international = 0 if col[4] == '\"no\"' else 1\n    voice = 0 if col[5] == '\"no\"'  else 1\n    label = 0 if churn == '\"no\"' else 1\n    features.append(international)\n    features.append(voice)\n    features += col[6:-1]\n    return LabeledPoint(label, Vectors.dense(features))\n\ntrainData = splitlines.map(parseLine)\ntrainData.take(3)","user":"anonymous","dateUpdated":"2019-06-18T02:18:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560823976599_1845757970","id":"20190618-021256_365361836","dateCreated":"2019-06-18T02:12:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:897","dateFinished":"2019-06-18T02:18:53+0000","dateStarted":"2019-06-18T02:18:50+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[LabeledPoint(0.0, [0.0,1.0,25.0,265.1,110.0,45.07,197.4,99.0,16.78,244.7,91.0,11.01,10.0,3.0,2.7,1.0]), LabeledPoint(0.0, [0.0,1.0,26.0,161.6,123.0,27.47,195.5,103.0,16.62,254.4,103.0,11.45,13.7,3.0,3.7,1.0]), LabeledPoint(0.0, [0.0,0.0,0.0,243.4,114.0,41.38,121.2,110.0,10.3,162.6,104.0,7.32,12.2,5.0,3.29,0.0])]\n"}]}},{"text":"%pyspark\nfrom pyspark.mllib.tree import DecisionTree\n\nmodel = DecisionTree.trainClassifier(trainData, numClasses=2, categoricalFeaturesInfo={},\n                                     impurity='gini', maxDepth=5)\n","user":"anonymous","dateUpdated":"2019-06-18T02:21:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560824218117_147043959","id":"20190618-021658_509081127","dateCreated":"2019-06-18T02:16:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:978","dateFinished":"2019-06-18T02:21:40+0000","dateStarted":"2019-06-18T02:21:31+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nprint(\"Learned classification tree model:\")\nprint(model.toDebugString())\n","user":"anonymous","dateUpdated":"2019-06-18T02:30:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560824491719_211083010","id":"20190618-022131_1642682021","dateCreated":"2019-06-18T02:21:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1114","dateFinished":"2019-06-18T02:30:47+0000","dateStarted":"2019-06-18T02:30:47+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Learned classification tree model:\nDecisionTreeModel classifier of depth 5 with 57 nodes\n  If (feature 3 <= 264.7)\n   If (feature 15 <= 3.0)\n    If (feature 0 <= 0.0)\n     If (feature 3 <= 221.4)\n      If (feature 4 <= 120.0)\n       Predict: 0.0\n      Else (feature 4 > 120.0)\n       Predict: 0.0\n     Else (feature 3 > 221.4)\n      If (feature 6 <= 259.8)\n       Predict: 0.0\n      Else (feature 6 > 259.8)\n       Predict: 1.0\n    Else (feature 0 > 0.0)\n     If (feature 13 <= 2.0)\n      Predict: 1.0\n     Else (feature 13 > 2.0)\n      If (feature 12 <= 12.9)\n       Predict: 0.0\n      Else (feature 12 > 12.9)\n       Predict: 1.0\n   Else (feature 15 > 3.0)\n    If (feature 3 <= 161.3)\n     If (feature 6 <= 230.2)\n      If (feature 9 <= 252.7)\n       Predict: 1.0\n      Else (feature 9 > 252.7)\n       Predict: 1.0\n     Else (feature 6 > 230.2)\n      If (feature 3 <= 138.5)\n       Predict: 1.0\n      Else (feature 3 > 138.5)\n       Predict: 0.0\n    Else (feature 3 > 161.3)\n     If (feature 6 <= 156.0)\n      If (feature 3 <= 193.3)\n       Predict: 1.0\n      Else (feature 3 > 193.3)\n       Predict: 0.0\n     Else (feature 6 > 156.0)\n      If (feature 3 <= 179.4)\n       Predict: 0.0\n      Else (feature 3 > 179.4)\n       Predict: 0.0\n  Else (feature 3 > 264.7)\n   If (feature 1 <= 0.0)\n    If (feature 6 <= 184.9)\n     If (feature 9 <= 213.3)\n      If (feature 3 <= 280.4)\n       Predict: 0.0\n      Else (feature 3 > 280.4)\n       Predict: 0.0\n     Else (feature 9 > 213.3)\n      If (feature 6 <= 123.5)\n       Predict: 0.0\n      Else (feature 6 > 123.5)\n       Predict: 1.0\n    Else (feature 6 > 184.9)\n     If (feature 9 <= 123.2)\n      If (feature 10 <= 103.0)\n       Predict: 1.0\n      Else (feature 10 > 103.0)\n       Predict: 0.0\n     Else (feature 9 > 123.2)\n      If (feature 6 <= 201.3)\n       Predict: 1.0\n      Else (feature 6 > 201.3)\n       Predict: 1.0\n   Else (feature 1 > 0.0)\n    If (feature 0 <= 0.0)\n     If (feature 6 <= 259.8)\n      Predict: 0.0\n     Else (feature 6 > 259.8)\n      If (feature 7 <= 103.0)\n       Predict: 0.0\n      Else (feature 7 > 103.0)\n       Predict: 1.0\n    Else (feature 0 > 0.0)\n     If (feature 3 <= 280.4)\n      Predict: 1.0\n     Else (feature 3 > 280.4)\n      If (feature 9 <= 229.8)\n       Predict: 0.0\n      Else (feature 9 > 229.8)\n       Predict: 1.0\n\n"}]}},{"text":"%pyspark\nhead = trainData.first()\nprint(model.predict(head.features))\n","user":"anonymous","dateUpdated":"2019-06-18T02:31:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560825031317_-1229450809","id":"20190618-023031_574290781","dateCreated":"2019-06-18T02:30:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1187","dateFinished":"2019-06-18T02:31:23+0000","dateStarted":"2019-06-18T02:31:20+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.0\n"}]}},{"text":"%pyspark\npredictions = model.predict(trainData.map(lambda p: p.features))\npredictions.take(3)\n","user":"anonymous","dateUpdated":"2019-06-18T02:32:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560825080304_629114596","id":"20190618-023120_519518173","dateCreated":"2019-06-18T02:31:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1294","dateFinished":"2019-06-18T02:32:18+0000","dateStarted":"2019-06-18T02:32:17+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[0.0, 0.0, 0.0]\n"}]}},{"text":"%pyspark\nlabels_and_preds = trainData.map(lambda p: p.label).zip(predictions)\nlabels_and_preds.take(3)","user":"anonymous","dateUpdated":"2019-06-18T02:32:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560825137399_-1168539534","id":"20190618-023217_941009406","dateCreated":"2019-06-18T02:32:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1375","dateFinished":"2019-06-18T02:32:35+0000","dateStarted":"2019-06-18T02:32:34+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(0.0, 0.0), (0.0, 0.0), (0.0, 0.0)]\n"}]}},{"text":"%pyspark\nfiltered_labels_and_preds = labels_and_preds.filter(lambda v : v[0] == v[1]) \ntest_accuracy = filtered_labels_and_preds.count() / float(trainData.count())\ntest_accuracy","user":"anonymous","dateUpdated":"2019-06-18T02:37:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560825154192_958767783","id":"20190618-023234_1997512468","dateCreated":"2019-06-18T02:32:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1456","dateFinished":"2019-06-18T02:37:39+0000","dateStarted":"2019-06-18T02:37:38+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.9492949294929492\n"}]}},{"text":"%pyspark\nfrom pyspark.mllib.evaluation import BinaryClassificationMetrics\n\nmetrics = BinaryClassificationMetrics(labels_and_preds)\n\nprint(\"Area under PR = %s\" % metrics.areaUnderPR)\nprint(\"Area under ROC = %s\" % metrics.areaUnderROC)\n","user":"anonymous","dateUpdated":"2019-06-18T02:38:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560825172889_-1276791893","id":"20190618-023252_629122564","dateCreated":"2019-06-18T02:32:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1537","dateFinished":"2019-06-18T02:38:43+0000","dateStarted":"2019-06-18T02:38:39+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Area under PR = 0.8207426929355243\nArea under ROC = 0.9335515176359455\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2019-06-18T02:38:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560825519615_-1644508384","id":"20190618-023839_323064899","dateCreated":"2019-06-18T02:38:39+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1863"}],"name":"Demo20190618","id":"2EDXAK7UE","angularObjects":{"2ECB8EECR:shared_process":[],"2ED1HD7NS:shared_process":[],"2EE9P3FDB:shared_process":[],"2EFC7YPSA:shared_process":[],"2EDTYY9UC:shared_process":[],"2EF7FMM2J:shared_process":[],"2EEFHWQN7:shared_process":[],"2EC3SCQSX:shared_process":[],"2EE19MJ8U:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}